# my-gas-spreadsheet-script-nissei

プロジェクト引継ぎ資料
1. このシステムの目的
このGoogle Apps Scriptプロジェクトは、設計業務の進捗と工数を管理するためのシステムです。以下の3つの主要なシートを連携させ、データ入力と管理業務の自動化・効率化を目指します。

メインシート: 全案件のマスターデータ

工数シート: 担当者ごとの作業用シート

請求シート: 請求業務用のデータ出力シート

2. 必要なツールと環境
このプロジェクトを開発・メンテナンスするためには、以下のツールが必要です。

Googleアカウント: スプレッドシートとApps Scriptを利用するために必須です。

Node.js: clasp を実行するために必要です。

clasp: Google Apps Scriptのコードをローカル環境で開発するためのコマンドラインツールです。

Git / GitHub: コードのバージョン管理を行います。

テキストエディタ: VS Codeなど、お好みのエディタ。

3. 新しい開発環境のセットアップ手順
新しい担当者が開発環境をセットアップするための手順は以下の通りです。

リポジトリのクローン:

Bash

git clone https://github.com/ACSshiga/my-gas-spreadsheet-script-nissei.git
cd my-gas-spreadsheet-script-nissei
claspへのログイン:

Bash

clasp login
ブラウザが開き、Googleアカウントでのログインと承認を求められます。

テスト用スプレッドシートの準備:

本番のシートとは別に、動作確認用のスプレッドシートを新しく作成します。

そのシートに必要なマスターシート（担当者マスタなど）やメインシートをコピーして準備します。

新しいスクリプトプロジェクトの作成と紐付け:

テスト用スプレッドシートのメニューから 拡張機能 > Apps Script を選択し、新しいスクリプトプロジェクトを作成します。

作成されたスクリプトの プロジェクトの設定 (⚙️) から スクリプト ID をコピーします。

ローカルの .clasp.json ファイルを開き、scriptId の値をコピーしたものに書き換えます。

コードの反映:

Bash

clasp push
このコマンドで、ローカルにある全てのコードがテスト用スプレッドシートにアップロードされます。

4. システムのアーキテクチャ（設計思想）
このシステムは、メンテナンス性と拡張性を高めるために、以下の設計原則に基づいています。

マスタ主導設計:

担当者、進捗状況、作業区分などの選択肢は、すべてマスタシートで管理されています。

スクリプトは常にこれらのマスタシートを参照するため、コードを触らずにマスタシートの編集だけでシステムの動作（ドロップダウンリストの内容など）を変更できます。

設定ファイルの集約 (Config.gs):

シート名、Google DriveのフォルダID、列の定義など、変更される可能性のある設定はすべてConfig.gsに集約されています。

レイアウト変更などにも、このファイルを修正するだけで柔軟に対応できます。

クラスベースの設計 (SheetService.gs):

MainSheetやInputSheetといったクラスを定義し、各シートの操作をオブジェクトとして扱っています。

これにより、コードの再利用性が高まり、各機能の役割分担が明確になっています。

5. 主なメンテナンス作業
担当者の追加・削除
**担当者マスタ**シートに行を追加または削除します。

メールアドレスを正しく入力します。

以上です。次回onEditまたはonOpenが実行された際に、システムが自動で変更を認識します。

進捗ステータスの追加
**進捗マスタ**シートに新しいステータス名を追加します。

**Config.gs**ファイル内のPROGRESS_COLORSに、新しいステータス名と対応する色を追加します。

以上です。ドロップダウンリストと色分けが自動で更新されます。




プロジェクト要件定義書：設計業務 進捗・工数管理システム (v3.0)
1. 概要と目的
本プロジェクトは、GoogleスプレッドシートおよびGoogle Apps Scriptを活用し、設計業務の進捗と工数を一元管理するシステムを構築する。**マスターデータである「メインシート」と、担当者個人の作業シートである「工数シート」、そして「請求シート」**を高度に連携させる。

システムの導入により、以下の実現を目指す。

業務の効率化: データ同期の完全自動化により、二重入力や転記作業を撲滅する。

正確性の向上: 手作業を排除し、ヒューマンエラーのない正確なデータ管理を実現する。

情報共有の円滑化: 各担当者が必要な情報に、他のメンバーを気にすることなくアクセスできる環境を提供する。

2. シート構成と役割
2.1. マスターシート群
システムの「正」となる情報を管理するシート群。これらのシートを更新するだけで、システム全体の動作（選択肢、色分け、処理対象など）が自動的に変更される。

シート名

役割

メインシート

全案件のマスターデータを管理する。すべての情報の原本となる。

担当者マスタ

システムで管理する全担当者の名前とGoogleアカウントのメールアドレスを定義する。メールアドレスは個人用ビューの識別に利用される。

進捗マスタ

「未着手」「完了」など、進捗ステータスの選択肢を定義する。

作業区分マスタ

「盤配」「線加工」など、作業区分の選択肢を定義する。

問い合わせマスタ

「問合済」「回答済」など、問い合わせステータスの選択肢を定義する。

2.2. 作業・出力用シート
シート名

役割

工数_{担当者名}

担当者ごとに自動で運用される作業用シート。日々の工数入力と進捗更新を行う、個人のタスクリストとして機能する。

請求シート

メインシートの情報を基に、指定した月の請求用に整形されたデータが自動で出力されるシート。

View_{担当者名}

（自動生成） 各担当者専用のフィルタリング用仮想シート。

3. 列構成
3.1. メインシート (データは2行目から)
列

列ヘッダー名

内容・役割

A

管理No

案件を一位に特定する管理番号

B

作業区分

「盤配」「線加工」を選択

C

機番

製品の機番

D

機種

製品の機種名

E

機番(リンク)

製番資料フォルダへのリンク（自動生成）

F

STD資料(リンク)

STD資料フォルダへのリンク（自動生成）

G～W

...

(案件ごとの詳細情報)

3.2. 工数シート (データは3行目から)
データは3行目から開始し、2行目には日付ごとの工数合計が自動で表示される。

G列は空白の区切り列として機能する。

表示される日付列は、当月と前月のものに自動で絞り込まれる。
| 列 | 列ヘッダー名 | 内容・役割 |
| :--- | :--- | :--- |
| A | 管理No. | 案件の管理番号 |
| B | 作業区分 | 「盤配」か「線加工」かを表示 |
| C | 機番 | 参考情報として機番を表示 |
| D | 進捗 | 担当者が自分のシートで進捗を更新 |
| E | 予定工数 | メインシートから同期された予定工数 |
| F | 実績工数合計 | H列以降の工数の合計値（SUM関数による自動計算） |
| G | (空白) | 区切り列 |
| H → | (日付) | 日々の実績工数を入力 |

4. 自動化機能の仕様
4.1. データ同期（インテリジェント・シンク）
メイン → 工数: メインシートの「担当者」列が絶対的な正となる。

新規アサイン: 担当者に設定されると、その担当者の工数シートに該当案件の行が自動で追加される。

アサイン解除: 担当者から外れると、行は工数シートから自動で削除される。

工数 → メイン: 工数シートで実績工数や進捗が編集されると、その内容はメインシートに即時自動で反映される。

データ保持: 担当者を誤って変更し元に戻した場合でも、過去に入力した工数データは失われない。実績工数は「誰が担当か」ではなく「誰が作業したか」の事実としてシステムが保持する。

4.2. UI/UX（見た目と使いやすさ）
個人用ビュー機能:

仕組み: メインシートを直接フィルタリングするのではなく、各ユーザー専用の仮想シート (View_{担当者名}) を一時的に自動生成する。これにより、各ユーザーは他の共同編集者に一切影響を与えることなく、自分専用の表示でデータのソートやフィルタリングを行える。

操作: カスタムメニューからワンクリックで**「自分の担当案件のみ表示」**を実行すると、自分にアサインされた案件だけが抽出された個人用シートが作成される。「表示を更新」で最新の状態に、「フィルタ表示を終了」で個人用シートが削除されメインシートに戻る。

工数シートの表示切替:

工数シートでは、カスタムメニューから**「すべての月を表示」**を選択することで、非表示になっている先々月以前の工数データを確認できる。

マスタ連動の入力規則: 「進捗」や「担当者」などの列には、各マスタシートの内容を基にしたドロップダウンリストが自動で設定される。マスタを更新すれば、選択肢も自動で更新される。

自動色付け: 進捗、担当者、問い合わせ状況などに応じて、セルの背景色が自動で変更される。

4.3. 請求シート連携
月別フィルタ: カスタムメニューから請求用サイドバーを開き、「対象月」を選択して更新ボタンを押すことで、指定月の請求データが生成される。

基準日: 請求対象の絞り込みは、メインシートの**「完了日」**を基準に行う。

データ形式: 「盤配」と「線加工」は合算せず、それぞれ別の行として出力する。内訳を明確にするため「作業区分」列も出力に含める。