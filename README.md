設計業務 進捗・工数管理システム
1. 概要
このプロジェクトは、GoogleスプレッドシートとGoogle Apps Scriptを活用し、設計業務の進捗と工数を一元管理するためのシステムです。

マスターデータである「メインシート」を中心に、担当者ごとの「工数シート」、そして「請求シート」を連携させ、データ入力の自動化と管理業務の効率化を目指します。

主な目的
業務の効率化: データ同期の完全自動化により、二重入力や転記作業を撲滅します。

正確性の向上: 手作業を排除し、ヒューマンエラーのない正確なデータ管理を実現します。

情報共有の円滑化: 各担当者が必要な情報に、他のメンバーを気にすることなくアクセスできる環境を提供します。

2. システム構成
本システムは、各種マスターシートで設定を管理し、メインシートを情報の原本とします。メインシートのデータは各担当者の工数シートに自動で同期され、工数シートでの入力はメインシートに集計されます。

シートの役割
シート種別	シート名	役割
マスターデータ	メインシート	全案件のマスターデータを管理する、すべての情報の原本。
作業用シート	工数_{担当者名}	担当者ごとの作業用シート。日々の工数入力と進捗更新を行う。
出力用シート	請求シート	指定した月の請求データを自動で出力するシート。
View_{担当者名}	（自動生成）各担当者専用のフィルタリング用仮想シート。
設定用シート	担当者マスタ	担当者の名前、メールアドレス、色分けを設定。
進捗マスタ	進捗ステータスの選択肢、色分け、完了/仕掛日の自動入力トリガーを設定。
作業区分マスタ	作業区分の選択肢と色分けを設定。
問い合わせマスタ	問い合わせステータスの選択肢と色分けを設定。

Google スプレッドシートにエクスポート
設計思想
マスタ主導設計: スクリプトの動作（選択肢や色分け）は、コードではなくマスタシートを編集することで変更可能です。

設定の集約: シート名やフォルダIDなど、環境に依存する設定はすべて Config.gs に集約されています。

クラスベース設計: SheetService.gs で各シートの操作をクラスとして定義し、コードの再利用性とメンテナンス性を高めています。

3. セットアップ手順
前提条件
Googleアカウント

Node.js と npm

Google clasp CLI (npm install -g @google/clasp)

Git

環境構築
リポジトリのクローン

Bash

git clone https://github.com/ACSshiga/my-gas-spreadsheet-script-nissei.git
cd my-gas-spreadsheet-script-nissei
Googleアカウントへのログイン

Bash

clasp login
スプレッドシートの準備

新規にGoogleスプレッドシートを作成します。

必要なシート（メインシート、および各種マスタシート）を準備します。

Apps Scriptプロジェクトの紐付け

準備したスプレッドシートのメニューから 拡張機能 > Apps Script を選択し、新しいスクリプトプロジェクトを作成します。

作成されたスクリプトの プロジェクトの設定 (⚙️) から スクリプトID をコピーします。

ローカルの .clasp.json ファイルを開き、scriptId の値をコピーしたものに書き換えます。

Config.gs の設定

src/Config.gs ファイルを開き、FOLDERS セクションにある各フォルダIDを、ご自身の環境に合わせて正しく設定してください。特に以下のIDは必須です。

REFERENCE_MATERIAL_PARENT: 機番フォルダを作成する親フォルダのID

SERIES_MODEL_PARENT: STD資料フォルダを作成する親フォルダのID

IMPORT_SOURCE_FOLDER: インポートしたいPDF申請書を置くフォルダのID

PROCESSED_FOLDER: 処理が完了したPDF申請書が移動されるフォルダのID

重要: Drive APIの有効化

PDFのインポート機能は、Google Drive API の有効化が必須です。

Apps Scriptエディタの左メニューから サービス の横にある + をクリックします。

リストから「Drive API」を選択し、「追加」ボタンを押します。

コードの反映

Bash

clasp push
このコマンドで、ローカルの全コードがスプレッドシートにアップロードされます。スプレッドシートを再読み込みすると、カスタムメニューが表示されます。

4. 使い方
カスタムメニューの機能
メニュー項目	説明
自分の担当案件のみ表示	自分に割り当てられた案件のみを抽出した仮想シート(View_...)を作成します。
表示を更新	個人用ビューを最新の状態に更新します。
フィルタ表示を終了	個人用ビューを削除し、メインシートに戻ります。
請求シートを更新	サイドバーが表示され、対象月を選択すると請求シートが更新されます。
全資料フォルダ作成	メインシートの機番と機種に基づき、Driveに資料フォルダを自動作成し、リンクを挿入します。
週次バックアップを作成	スプレッドシート全体のバックアップをDriveに作成します。
フォルダからインポートを実行	Config.gsで指定したフォルダからPDF申請書を読み込み、メインシートにデータを追加します。
スクリプトのキャッシュをクリア	スクリプトが保持している一時的なデータ（マスタ情報など）をクリアし、再読み込みさせます。

Google スプレッドシートにエクスポート
5. メンテナンスと仕様
マスタシートの仕様
マスタシートを編集する際は、以下の列構成を維持してください。

担当者マスタ:

A列: 担当者名 (ドロップダウンリストや工数シート名に使われます)

B列: メールアドレス (個人用ビュー機能でユーザーを識別するために必須です)

C列: 背景色 (メインシートの担当者セルがこの色で色付けされます)

進捗マスタ:

A列: 進捗ステータス名 (ドロップダウンリストに使われます)

B列: 背景色 (進捗セルがこの色で色付けされます)

C列: 完了日トリガー (TRUEにすると、このステータスに変更した日付が「完了日」として自動入力されます)

D列: 仕掛日トリガー (TRUEにすると、このステータスに初めて変更した日付が「仕掛日」として自動入力されます)

6. トラブルシューティング
スクリプトが期待通りに動作しない場合、まずはログを確認してください。

Apps Scriptエディタの左メニューから「実行数」をクリックします。

問題が発生した関数の実行履歴を探し、「ログを開く」をクリックします。

特にPDFのインポート処理やデータ同期処理で問題が発生した場合は、ここに詳細なエラーメッセージや処理状況が出力されます。