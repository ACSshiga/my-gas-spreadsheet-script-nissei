# プロジェクト要件定義書：設計業務 進捗・工数管理システム (v2.0)

## 1. 概要と目的
本プロジェクトは、GoogleスプレッドシートおよびGoogle Apps Scriptを活用し、設計業務の進捗と工数を一元管理するシステムを構築する。**マスターデータである「メインシート」**と、**担当者個人の作業シートである「工数シート」**、そして**「請求シート」**を高度に連携させる。

システムの導入により、以下の実現を目指す。
* **業務の効率化**: データ同期の完全自動化により、二重入力や転記作業を撲滅する。
* **正確性の向上**: 手作業を排除し、ヒューマンエラーのない正確なデータ管理を実現する。
* **情報共有の円滑化**: 各担当者が必要な情報に、他のメンバーを気にすることなくアクセスできる環境を提供する。

---

## 2. シート構成と役割

### 2.1. マスターシート群
**システムの「正」となる情報**を管理するシート群。これらのシートを更新するだけで、システム全体の動作（選択肢、色分け、処理対象など）が自動的に変更される。

| シート名 | 役割 |
| :--- | :--- |
| **メインシート** | 全案件のマスターデータを管理する。すべての情報の原本となる。 |
| **担当者マスタ** | システムで管理する全担当者の**名前**と**Googleアカウントのメールアドレス**を定義する。メールアドレスは個人用フィルタの識別に利用される。 |
| **進捗マスタ** | 「未着手」「完了」など、進捗ステータスの選択肢を定義する。 |
| **作業区分マスタ** | 「盤配」「線加工」など、作業区分の選択肢を定義する。 |
| **問い合わせマスタ** | 「問合済」「回答済」など、問い合わせステータスの選択肢を定義する。 |

### 2.2. 作業・出力用シート
| シート名 | 役割 |
| :--- | :--- |
| **工数\_{担当者名}** | 担当者ごとに自動で運用される作業用シート。日々の工数入力と進捗更新を行う、**個人のタスクリスト**として機能する。 |
| **請求シート** | メインシートの情報を基に、指定した月の請求用に整形されたデータが自動で出力されるシート。 |

---

## 3. 列構成

### 3.1. メインシート (データは2行目から)
| 列 | 列ヘッダー名 | 内容・役割 |
| :--- | :--- | :--- |
| **A** | **管理No** | 案件を一位に特定する管理番号 |
| **B** | **作業区分** | 「盤配」「線加工」を選択 |
| **C** | **機番** | 製品の機番 |
| **D** | **機種** | 製品の機種名 |
| **E** | **機番(リンク)** | 製番資料フォルダへのリンク（自動生成） |
| **F** | **STD資料(リンク)**| STD資料フォルダへのリンク（自動生成） |
| **G～W** | ... | (案件ごとの詳細情報) |

### 3.2. 工数シート (データは3行目から)
* **データは3行目から開始**し、**2行目には日付ごとの工数合計**が自動で表示される。
* 表示される日付列は、**当月と前月のものに自動で絞り込まれる**。
| 列 | 列ヘッダー名 | 内容・役割 |
| :--- | :--- | :--- |
| **A** | **管理No.** | 案件の管理番号 |
| **B** | **作業区分** | 「盤配」か「線加工」かを表示 |
| **C** | **機番** | 参考情報として機番を表示 |
| **D** | **進捗** | 担当者が自分のシートで進捗を更新 |
| **E** | **予定工数** | メインシートから同期された予定工数 |
| **F** | **実績工数合計** | G列以降の工数の合計値（`SUM`関数による自動計算） |
| **G →** | **(日付)** | 日々の実績工数を入力 |

---

## 4. 自動化機能の仕様

### 4.1. データ同期（インテリジェント・シンク）
* **メイン → 工数**: メインシートの「担当者」列が絶対的な正となる。
    * **新規アサイン**: 担当者に設定されると、その担当者の工数シートに該当案件の行が自動で追加される。
    * **アサイン解除**: 担当者から外れると、行は工数シートから自動で削除される（表示されなくなる）。
* **工数 → メイン**: 工数シートで実績工数や進捗が編集されると、その内容はメインシートに即時自動で反映される。
* **データ保持**: 担当者を誤って変更し元に戻した場合でも、過去に入力した工数データは失われずに復元される。実績工数は「誰が担当か」ではなく「誰が作業したか」の事実としてシステムが保持する。

### 4.2. UI/UX（見た目と使いやすさ）
* **パーソナルフィルタ機能**:
    * **仕組み**: Googleスプレッドシートの**「フィルタ表示 (Filter Views)」**機能をスクリプトで自動制御する。これにより、各ユーザーは**他の共同編集者に一切影響を与えることなく**、自分専用のフィルタを自由に利用できる。
    * **担当者フィルタ**: カスタムメニューからワンクリックで**「自分の担当案件のみ表示」**が可能。スクリプトが操作中のユーザーのメールアドレスを自動で認識し、担当者マスタと照合して実行する。
    * **多機能フィルタ**: サイドバーから「進捗」など、他の列の条件も組み合わせて自由に絞り込みができる。
    * **状態の記憶**: 一度適用したフィルタはユーザーごとに記憶され、次回スプレッドシートを開いた際に自動で復元される。
* **マスタ連動の入力規則**: 「進捗」や「担当者」などの列には、各マスタシートの内容を基にしたドロップダウンリストが自動で設定される。マスタを更新すれば、選択肢も自動で更新される。
* **自動色付け**: 進捗、担当者、問い合わせ状況などに応じて、セルの背景色が自動で変更される。

### 4.3. 請求シート連携
* **月別フィルタ**: カスタムメニューから請求用サイドバーを開き、「対象月」を選択して更新ボタンを押すことで、指定月の請求データが生成される。
* **基準日**: 請求対象の絞り込みは、メインシートの**「完了日」**を基準に行う。
* **データ形式**: 「盤配」と「線加工」は合算せず、それぞれ別の行として出力する。内訳を明確にするため「作業区分」列も出力に含める。# プロジェクト要件定義書：設計業務 進捗・工数管理システム

## 1. 概要
本プロジェクトは、GoogleスプレッドシートおよびGoogle Apps Scriptを用いて、設計業務の進捗と工数を管理するシステムを構築する。「メインシート」を全案件のマスターデータとし、担当者ごとの「工数シート」と連携させる。データの入力と同期を自動化し、管理業務の効率化と正確性の向上を目指す。

---

## 2. シート構成と役割

### 2.1. マスターシート群
| シート名 | 役割 |
| :--- | :--- |
| **メインシート** | 全案件のマスターデータを管理する。すべての情報の原本となる。 |
| **担当者マスタ** | システムで管理する全担当者の**名前**と**メールアドレス**を定義する。 |
| **進捗マスタ** | 「未着手」「完了」など、進捗ステータスの選択肢を定義する。 |
| **作業区分マスタ** | 「盤配」「線加工」など、作業区分の選択肢を定義する。 |
| **問い合わせマスタ** | 「問合済」「回答済」など、問い合わせステータスの選択肢を定義する。 |

### 2.2. 作業用シート
| シート名 | 役割 |
| :--- | :--- |
| **工数\_{担当者名}** | 担当者ごとに自動で運用される作業用シート。日々の工数入力と進捗更新を行う。 |
| **請求シート** | メインシートの情報を基に、請求用に整形されたデータが自動で出力されるシート。 |

---

## 3. 列構成

### 3.1. メインシート
| 列 | 列ヘッダー名 | 内容・役割 |
| :--- | :--- | :--- |
| **A** | **管理No** | 案件を一位に特定する管理番号 |
| **B** | **作業区分** | 「盤配」「線加工」を選択 |
| **C** | **機番** | 製品の機番 |
| **D** | **機種** | 製品の機種名 |
| **E** | **機番(リンク)** | 製番資料フォルダへのリンク（自動生成） |
| **F** | **STD資料(リンク)**| STD資料フォルダへのリンク（自動生成） |
| **G** | **参考製番** | 参考にする過去の製番 |
| **H** | **回路図番** | 回路図の図面番号 |
| **I** | **問い合わせ** | 問い合わせ状況 |
| **J** | **仮コード** | 仮のコード番号 |
| **K** | **担当者** | 設計の主担当者 |
| **L** | **納入先** | 製品の納入先 |
| **M** | **予定工数** | 作業ごとの予定工数（時間） |
| **N** | **実績工数** | 作業ごとの実績工数（工数シートから自動集計） |
| **O** | **進捗** | 作業ごとの進捗状況 |
| **P** | **仕掛日** | いずれかの進捗が「未着手」以外になった日（自動記録） |
| **Q** | **完了日** | 進捗が「完了」になった日（自動記録） |
| **R** | **作図期限** | 作図の提出期限 |
| **S** | **進捗記入者** | 最後に進捗を更新した担当者名（自動記録） |
| **T** | **更新日時** | 行データが最後に更新された日時（自動記録） |
| **U** | **係り超過理由**| 作業が遅延している場合の理由 |
| **V** | **注意点** | その案件に関する特記事項や注意点 |
| **W** | **備考** | その他の情報 |

### 3.2. 工数シート
* **データは3行目から開始**し、**2行目には日付ごとの工数合計**が自動で表示される。
| 列 | 列ヘッダー名 | 内容・役割 |
| :--- | :--- | :--- |
| **A** | **管理No.** | 案件の管理番号 |
| **B** | **作業区分** | 「盤配」か「線加工」かを表示 |
| **C** | **機番** | 参考情報として機番を表示 |
| **D** | **進捗** | 担当者が自分のシートで進捗を更新 |
| **E** | **予定工数** | メインシートから同期された予定工数 |
| **F** | **実績工数合計** | G列以降に入力された日々の工数の合計値（自動計算） |
| **G →** | **(日付)** | 日々の実績工数を時間単位で入力 |

---

## 4. 自動化機能の仕様

### 4.1. データ同期
* **メイン → 工数**: メインシートで案件の担当者が割り当てられると、その担当者の工数シートに該当案件の行が自動で追加される。担当者から外れると、行は自動で削除される。
* **工数 → メイン**: 工数シートで実績工数や進捗が編集されると、その内容はメインシートに即時自動で反映される。
* **担当者変更時のデータ保持**: 担当者を誤って変更し、元に戻した場合でも、過去に入力した工数データは失われずに復元される。

### 4.2. UI/UX（見た目と使いやすさ）
* **個人用フィルタ**:
    * 各ユーザーは、**他の共同編集者に影響を与えることなく**、自分専用のフィルタ表示を自由に利用できる。
    * カスタムメニューからワンクリックで**「自分の担当案件のみ表示」**が可能。
    * サイドバーから「進捗」など、他の列の条件も組み合わせて自由に絞り込みができる。
* **フィルタ状態の記憶**: 一度適用したフィルタは自動で記憶され、次回スプレッドシートを開いた際に自動で復元される。
* **マスタ連動の入力規則**: 「進捗」や「担当者」などの列には、各マスタシートの内容を基にしたドロップダウンリストが自動で設定される。マスタシートを更新すれば、選択肢も自動で更新される。
* **自動色付け**: 進捗、担当者、問い合わせ状況などに応じて、セルの背景色が自動で変更される。

### 4.3. Google Drive連携
* カスタムメニューから、メインシートの「機番」を基に資料フォルダを自動作成し、シートにリンクを自動で挿入する。
* 週次の自動バックアップ機能を持つ。

### 4.4. 請求シート連携
* カスタムメニューから、メインシートの情報を基にした請求用のシートを自動で作成・更新する。
* 請求シートでは、「盤配」と「線加工」は合算せず、それぞれ別の行として出力される。